"use strict";const s=require("electron"),t=require("path");process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";let e,o;const c=s.Menu.buildFromTemplate([{label:"显示窗口",click:()=>{e==null||e.show()}},{label:"最小化",click:()=>{e==null||e.minimize()}},{label:"退出",click:()=>{process.platform!=="darwin"&&s.app.quit()}}]);function i(){e=new s.BrowserWindow({frame:!1,resizable:!0,width:1024,height:720,backgroundColor:"#2e2b43",icon:t.join(__dirname,"../public/favicon.ico"),webPreferences:{nodeIntegration:!0,preload:t.join(__dirname,"preload.js")}}),process.env.NODE_ENV!=="development"?e.loadFile(t.join(__dirname,"../dist/index.html")).then():(e.loadURL(`${process.env.VITE_DEV_SERVER_URL}:
                            ${process.env.VITE_DEV_SERVER_PORT}`).then(),e.webContents.openDevTools())}function l(){o=new s.Tray(t.join(__dirname,"../public/favicon.ico")),o.setToolTip("ChinaOracle"),o.setContextMenu(c)}s.app.whenReady().then(()=>{i(),l(),e==null||e.webContents.session.webRequest.onBeforeSendHeaders((r,n)=>{n({requestHeaders:{Origin:"*",...r.requestHeaders}})}),e==null||e.webContents.session.webRequest.onHeadersReceived((r,n)=>{n({responseHeaders:{"Access-Control-Allow-Origin":["*"],...r.responseHeaders}})}),s.app.on("activate",function(r){s.BrowserWindow.getAllWindows().length===0&&i()}),o==null||o.on("click",function(){e==null||e.show()})});s.app.on("ready",()=>{s.ipcMain.on("minimize-window",()=>{e==null||e.minimize()}),s.ipcMain.on("maximize-window",()=>{e!=null&&e.isMaximized()?e==null||e.unmaximize():e==null||e.maximize()}),s.ipcMain.on("close-window",r=>{r.preventDefault(),e==null||e.hide()})});
